/*! kahn1990_new_book 2016-05-22 */
function deviceDetection(a){var b=a(navigator.userAgent,navigator.appVersion,navigator.platform);switch(!0){case b.android.length>1:b.osType="android",b.osName="android",b.osVersion=b.android[2];break;case b.ios===!0:switch(b.osType="ios",!0){case b.iphone.length>1:b.osVersion=b.iphone[2].replace(/_/g,"."),b.osName="iphone",480===screen.height?document.documentElement.classList.add("iphone4"):568===screen.height?document.documentElement.classList.add("iphone5"):screen.height>568&&document.documentElement.classList.add("iphone6+");break;case b.ipad.length>1:b.osVersion=b.ipad[2].replace(/_/g,"."),b.osName="ipad";break;case b.ipod.length>1:b.osVersion=b.ipod[3]?_this.ipod[3].replace(/_/g,"."):null,b.osName="ipod";break;default:b.osVersion="undefined",b.osName="undefined"}b.ios&&b.osVersion&&navigator.userAgent.indexOf("Version/")>=0&&"10"===b.osVersion.split(".")[0]&&(b.osVersion=navigator.userAgent.toLowerCase().split("version/")[1].split(" ")[0]);break;default:b.osType="undefined"}if(b.win32&&document.documentElement.classList.add("win32"),"undefined"!==b.osType&&(b.classNames.push(b.osType,b.osType+"-"+b.osVersion.split(".")[0],b.osType+"-"+b.osVersion.replace(/\./g,"-")),"ios"===b.osType))for(var c=parseInt(b.osVersion.split(".")[0],10),d=c-1;d>=6;d--)b.classNames.push("ios-gt-"+d);if(b.classNames.push("pixel-ratio-"+Math.floor(b.pixelRatio)),b.pixelRatio>=2&&b.classNames.push("retina"),b.classNames.length>0)for(var e=0;e<b.classNames.length;e++)document.documentElement.classList.add(b.classNames[e]);return{osType:b.osType,osName:b.osName,osVersion:b.osVersion,isWeiXin:b.MicroMessenger,iswebView:(b.iphone||b.ipad||b.ipod)&&navigator.userAgent.match(/.*AppleWebKit(?!.*Safari)/i)||!1,support:{canTouch:b.canTouch,msPointer:b.msPointer}}}var ObjectPrototype=Object.prototype,toString=ObjectPrototype.toString,_k={isArguments:function(a){return"[object Arguments]"===toString.call(a)},isNumber:function(a){return"[object Number]"===toString.call(a)},isString:function(a){return"[object String]"===toString.call(a)},isDate:function(a){return"[object Date]"===toString.call(a)},isRegExp:function(a){return"[object RegExp]"===toString.call(a)},isError:function(a){return"[object Error]"===toString.call(a)},isSymbol:function(a){return"[object Symbol]"===toString.call(a)},isMap:function(a){return"[object Map]"===toString.call(a)},isWeakMap:function(a){return"[object WeakMap]"===toString.call(a)},isSet:function(a){return"[object Set]"===toString.call(a)},isWeakSet:function(a){return"[object WeakSet]"===toString.call(a)},isArray:function(a){return Array.isArray?Array.isArray(a):"[object Array]"===toString.call(a)},isHas:function(a,b){return null!=a&&hasOwnProperty.call(a,b)},isHasName:function(a){if(!this.isObject(a))return[];if(Object.keys)return Object.keys(a);var b=[];for(var c in a)this.isHas(a,c)&&b.push(c);return b},isObject:function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},isEmpty:function(a){return null==a?!0:isArrayLike(a)&&(this.isArray(a)||this.isString(a)||this.isArguments(a))?0===a.length:0===this.isHasName(a).length},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)?a:(console.log("parameter is no function ====> "+a),!1)},isAddProperty:function(a){return function(b){return null==b?void 0:b[a]}},isArrayLength:function(a){var b=this.isAddProperty("length")(a);return"number"==typeof b&&b>=0&&b<=Math.pow(2,8)-1},isElement:function(a){return!(!a||1!==a.nodeType)},isFinite:function(a){return!this.isSymbol(a)&&this.isFinite(a)&&!this.isNaN(parseFloat(a))},isNaN:function(a){return this.isNaN(a)&&this.isNumber(a)},isBoolean:function(a){return a===!0||a===!1||"[object Boolean]"===toString.call(a)},isNull:function(a){return null===a},isUndefined:function(a){return void 0===a}};_k.deviceOs=deviceDetection(function(a,b,c){return{win32:"Win32"===c,ie:!!window.ActiveXObject||"ActiveXObject"in window,ieVersion:Math.floor((/MSIE ([^;]+)/.exec(a)||[0,"0"])[1]),ios:/iphone|ipad|ipod/gi.test(b),ipad:a.match(/(iPad).*OS\s([\d_]+)/)||!1,ipod:a.match(/(iPod)(.*OS\s([\d_]+))?/)||!1,iphone:!a.match(/(iPad).*OS\s([\d_]+)/)&&a.match(/(iPhone\sOS)\s([\d_]+)/)||!1,safari:/Version\//gi.test(b)&&/Safari/gi.test(b),uiWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(a),android:a.match(/(Android);?[\s\/]+([\d.]+)?/)||!1,androidChrome:a.toLowerCase().indexOf("chrome")>=0,chrome:/Chrome/gi.test(a),chromeVersion:parseInt((/Chrome\/([0-9]*)/gi.exec(a)||[0,0])[1],10),webkit:/AppleWebKit/.test(b),uc:-1!==b.indexOf("UCBrowser"),Browser:/ Browser/gi.test(b),MiuiBrowser:/MiuiBrowser/gi.test(b),MicroMessenger:"micromessenger"==a.toLowerCase().match(/MicroMessenger/i),pixelRatio:window.devicePixelRatio||1,canTouch:"ontouchstart"in document,msPointer:window.navigator.msPointerEnabled,classNames:[],osType:"",osName:"",osVersion:[],mi4:/Mi 4LTE/gi.test(navigator.userAgent)}}),_k.optimizeCb=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},_k.forEach=function(a,b,c){c&&(b=_k.optimizeCb(b,c));var d,e;switch(!0){case _k.isString(a):for(d=0,e=a.length;d!==e;++d)b(a.charAt(d));break;case _k.isArray(a):for(d=0,e=a.length;e>d;d++)b(a[d],d,a);break;case _k.isObject(a):var f=_k.isHasName(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a);break;default:console.error("forEach err !")}},_k.callFunctionByString=function(a){return new Function("return "+a)().apply(null,_k.argumentsToArray(arguments,1))},_k.callFunctionByWith=function(a,b){return a(b)},_k.recursion=function(a){return a.apply(null,_k.argumentsToArray(arguments,1)),a},_k.containsAll=function(a){return _k.forEach(_k.argumentsToArray(arguments,1),function(b){return-1===a.indexOf(b)?!1:void 0}),!0},_k.bind=function(a,b){var c,d,e=new Function;if(a.bind===nativeBind&&nativeBind)return nativeBind.apply(a,_k.argumentsToArray(arguments,1));if(!_k.isFunction(a))throw new TypeError;return d=argumentsToArray(arguments,2),c=function(){if(!(this instanceof c))return a.apply(b,d.concat(_k.argumentsToArray(arguments)));e.prototype=a.prototype;var f=new e,g=a.apply(f,d.concat(slice.call(arguments)));return Object(g)===g?g:f}},_k.formatString=function(a){var b=arguments,c=new RegExp("%([1-"+arguments.length+"])","g");return String(a).replace(c,function(a,c){return b[c]})},_k.argumentsToArray=function(a,b){return b?Array.prototype.slice.call(a,b):Array.prototype.slice.call(a)},_k.makeFunc=function(){var a=_k.argumentsToArray(arguments),b=a.shift();return function(){return b.apply(null,_k.arrayUnique(a.concat(_k.argumentsToArray(arguments))))}},_k.timersToExecuteFunction=function(a,b,c){return function(){if(b>=0){a.apply(null,arguments);var d=_k.argumentsToArray(arguments),e=arguments.callee;setTimeout(function(){e.apply(null,d)},c)}}},_k.merge=function(a,b){return _k.forEach(b,function(b){_k.forEach(b,function(b,c){void 0!==c&&(_k.isObject(c)&&_k.isObject(a[b])?_k.insert(a[b],c):a[b]=c)})}),a},_k.insert=function(a){return _k.merge(a,_k.argumentsToArray(arguments,1))},_k.extend=function(){var a={};return _k.merge(a,arguments)},_k.defineAutoProperty=function(a,b,c){_k.callFunctionByWith(function(a){_k.isString(b)?a(b,c):_k.forEach(b,a)},function(b,c){c=c||{};var d=c.value,e=c.set;void 0!==d&&e(d),Object.defineProperty(a,b,{enumerable:!0,get:function(){return d},set:function(a){d=e?void 0===e(a)?a:e(a):a}})})},_k.exclude=function(a,b){function c(a){var b={};return array.foreach(a,function(a){b[a]=!0}),{contains:function(a){return b[a]===!0}}}var d=c(b),e={};return foreach(a,function(a,b){!d.contains(a)&&(e[a]=b)}),e},_k.arrayUnique=function(a){for(var b,c=[],d={},e=0;null!=(b=a[e]);e++)d[b]||(c.push(b),d[b]=!0);return c},_k.collect=function(a){var b=[];return a(function(a){b.push(a)}),b},_k.collect.prototype.object=function(a){var b={};return a(function(a,c){b[a]=c}),b},_k.creatArrayRange=function(a,b){function c(a,b,c){var d,e,f;for(c?(f=c,d=a,e=b):(f=b,d=0,e=a);d!==e;++d)f(d)}return _k.collect(function(d){void 0===b?c(a,d):c(a,b,d)})},_k.arrayBackLast=function(a,b){return void 0===b?a[a.length-1]:(a[a.length-1]=b,a)},_k.arrayFilter=function(a,b){var c=[];return _k.forEach(a,function(a){!b(a)&&c.push(a)}),c},_k.map=function(a,b){var c=[];return _k.forEach(a,function(a,d){c.push(b(a,d))}),c},_k.contains=function(a,b){for(var c=0,d=a.length;c!==d;++c)if(b(a[c]))return!0;return!1},_k.reverse=function(a){var b=a.length-1,c=-1===b?[]:new Array(b);return _k.forEach(a,function(a,d){c[b-d]=a}),c},_k.concat=function(a){for(var b=[],c=_k.argumentsToArray(arguments),d=0;d<c.length;d++)_k.forEach(c[d],function(a){b.push(a)});return b},_k.reduce=function(a,b){if(1===a.length)return a[0];for(var c=b(a[0],a[1]),d=2,e=a.length;e>d;++d)c=b(c,a[d]);return c},_k.arrayApply=function(a){return function(b){return a.apply(null,b)}},_k.urlParse=function(a){return new URL(a)},_k.urlToAbsolute=function(a){var b=document.createElement("a");return b.href=a,b.href},_k.urlEncodeObject=function(a){var b="",c=0;return _k.forEach(a||{},function(a,d){void 0!==d&&(c++&&(b+="&"),b+=encodeURIComponent(a),b+="=",b+=encodeURIComponent(d))}),b},_k.parsePairString=function(a,b,c,d){_k.forEach(a.split(b),function(a){var b=a.split(c);d(b[0],b[1])})},_k.concatArg=function(a,b){a=_k.urlParse(a);var c=_k.urlEncodeObject(_k.extend(a.arg,b));return a.origin+a.pathname+(c?"?":"")+c+a.hash},_k.removeArg=function(a,b){a=_k.urlParse(a);var c=_k.urlEncodeObject(_k.exclude(a.arg,b));return a.origin+a.pathname+(c?"?":"")+c+a.hash},_k.URL=function(a){var b=/(?:((?:[^:\/]*):)\/\/)?([^:\/?#]*)(?::([0-9]*))?(\/[^?#]*)?(\?[^#]*)?(#.*)?/;b.test(a)&&(this.protocol=RegExp.$1,this.hostname=RegExp.$2,this.port=RegExp.$3,this.pathname=RegExp.$4,this.search=RegExp.$5,this.hash=RegExp.$6)},URL.prototype.inspect=URL.prototype.valueOf=URL.prototype.toString=URL.prototype.toJSON=function(){return this.href},Object.defineProperties(URL.prototype,{href:{get:function(){return this.origin+this.pathname+this.search+this.hash}},host:{get:function(){return this.hostname+(this.port?":"+this.port:"")}},origin:{get:function(){return this.protocol?this.protocol+"//"+this.host:this.host}},arg:{get:function(){var a={};return _k.parsePairString(this.search.substring(1),"&","=",function(b,c){""!==b&&(a[b]=decodeURIComponent(c))}),a}}}),_k.checkUrl=function(a){var b="^((https|http|ftp|rtsp|mms)?://)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$",c=new RegExp(b);return c.test(a)},_k.request=function(a,b){if(!a.method||!/POST|PUT|PATCH|DELETE|GET/gi.test(a.method))throw new Error("method error");if(!a.url&&!_k.checkUrl(a.url))throw new Error("url error");null!=a.data||"create"!==a.method&&"update"!==a.method&&"patch"!==a.method||_k.isObject(a.data)&&(a.data=JSON.stringify(a.data));var c=new XMLHttpRequest;if(c.onload=function(){b&&b(null,c)},c.onerror=function(a){b&&b(a,c)},c.open(a.method,a.url,!0),a.emulateJSON?(c.setRequestHeader("contentType","application/x-www-form-urlencoded"),a.data=a.data||{}):c.setRequestHeader("contentType","application/json"),"PUT"===a.method||"DELETE"===a.method||"PATCH"===a.method){a.method="POST";var d=a.beforeSend;a.beforeSend=function(b){return b.setRequestHeader("X-HTTP-Method-Override",a.method),d?d.apply(this,arguments):void 0}}return a.setHeader&&_k.forEach(a.setHeader,function(a,b){c.setRequestHeader(a,b)}),a.responseType&&(c.responseType=a.responseType),c.send(a.data||null),c},_k.cookiesMap={},_k.forEach(document.cookie.split(";"),function(a){var b=a.split("=");_k.cookiesMap[b[0].trim()]=b[1]}),_k.getCookie=function(a){return _k.cookiesMap[a]},_k.linkedList=function(){function a(a){a.inserted===!0&&(a.previous?a.previous.next=a.next:b=a.next,a.next?a.next.previous=a.previous:c=a.previous,a.inserted=!1)}var b=null,c=null;return{head:function(){return b},tail:function(){return c},insert:function(d,e){if(d!==e){a(d);var f=e?e.previous:c;return d.next=e,d.previous=f,f?f.next=d:b=d,e?e.previous=d:c=d,d.inserted=!0,d}},remove:a}},_k.iterate=function(a,b,c,d){var e,f,g,h,i;for(_k.isFunction(b)?(e=null,f=b,g=c):(e=b,f=c,g=d),h=a;h!==e;h=g?h.previous:h.next)if(void 0!==(i=f(h)))return i},_k.event=function(){var a=_k.linkedList();return{trigger:function(){for(var b=a.head();null!==b;b=b.next)b.apply(null,arguments)},regist:function(b){var c=a.insert(b,null);return{func:b,remove:function(){a.remove(c)}}}}},_k.doCallbackByTasksDone=function(a,b){var c=a.length,d={done:[],error:[]};b||console.log("缺少回调函数"),0===c?b(d.done,d.error):_k.forEach(a,function(a){a(function(a,e){e&&(d.done.push("no result"),d.error.push(e),b(d.done,d.error)),d.done.push(a),0===--c&&b(d.done)})})},_k.Waiter=function(a){var b=Event();return a(function(){b&&(b.trigger(),b=null)}),{onComplete:function(a){return b?b.regist(a):(a&&a(),{remove:function(){}})},cancel:function(){b=null}}},_k.Loader=function(a){var b;return{load:function(c){return b||(b=Waiter(a)),b.onComplete(c)}}},_k.Schedule=function(){var a=null,b=!1;return{prepare:function(c){a=c,b&&a()},start:function(){a&&a(),b=!0}}},_k.once=function(a,b){var c=b(function(){a(),array.foreach(c,function(a){a.remove()})})},_k.setTimeout=function(a,b){var c=window.setTimeout(a,b);return{remove:function(){window.clearTimeout(c)}}},_k.polling=function(a,b,c){var d;return func.recursion(function e(){a()?b():d=setTimeout(e,c||100)}),{remove:function(){d&&clearTimeout(d)}}},_k.base64=function(a){for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=[],d=0;d<b.length;d++)c[b.charCodeAt(d)]=d;return{decode:function(){if(_k.isString(a))return console.log("no string"),!1;for(var b=a.replace(/[^A-Za-z0-9\+\/\=]/g,""),d=b.length;"="===b.charAt(d-1);)d--;for(var e=new Uint8Array(d/4*3<<0),f=0,g=0;d>f;f+=4,g+=3)d>f+1&&(e[g+0]=(63&c[b.charCodeAt(f+0)])<<2|(48&c[b.charCodeAt(f+1)])>>4),d>f+2&&(e[g+1]=(15&c[b.charCodeAt(f+1)])<<4|(60&c[b.charCodeAt(f+2)])>>2),d>f+3&&(e[g+2]=(3&c[b.charCodeAt(f+2)])<<6|(63&c[b.charCodeAt(f+3)])<<0);return e},encode:function(){if(_k.isObject(a))return console.log("no object"),!1;for(var c=a,d=c.byteLength,e="",f=0;d>f;f+=3)e+=b.charAt((252&c[f])>>2),e+=b.charAt((3&c[f])<<4|(d>f+1?(240&c[f+1])>>4:0)),e+=d>f+1?b.charAt((15&c[f+1])<<2|(d>f+2?(192&c[f+2])>>6:0)):"=",e+=d>f+2?b.charAt((63&c[f+2])<<0):"=";return e}}};
/*! kahn1990_new_book 最后修改于： 2016-05-22 */