/*! kahn1990_new_book 2016-05-22 */
_k.linkedList=function(){function a(a){a.inserted===!0&&(a.previous?a.previous.next=a.next:b=a.next,a.next?a.next.previous=a.previous:c=a.previous,a.inserted=!1)}var b=null,c=null;return{head:function(){return b},tail:function(){return c},insert:function(d,e){if(d!==e){a(d);var f=e?e.previous:c;return d.next=e,d.previous=f,f?f.next=d:b=d,e?e.previous=d:c=d,d.inserted=!0,d}},remove:a}},_k.iterate=function(a,b,c,d){var e,f,g,h,i;for(_k.isFunction(b)?(e=null,f=b,g=c):(e=b,f=c,g=d),h=a;h!==e;h=g?h.previous:h.next)if(void 0!==(i=f(h)))return i},_k.event=function(){var a=_k.linkedList();return{trigger:function(){for(var b=a.head();null!==b;b=b.next)b.apply(null,arguments)},regist:function(b){var c=a.insert(b,null);return{func:b,remove:function(){a.remove(c)}}}}},_k.doCallbackByTasksDone=function(a,b){var c=a.length,d={done:[],error:[]};b||console.log("缺少回调函数"),0===c?b(d.done,d.error):_k.forEach(a,function(a){a(function(a,e){e&&(d.done.push("no result"),d.error.push(e),b(d.done,d.error)),d.done.push(a),0===--c&&b(d.done)})})},_k.Waiter=function(a){var b=Event();return a(function(){b&&(b.trigger(),b=null)}),{onComplete:function(a){return b?b.regist(a):(a&&a(),{remove:function(){}})},cancel:function(){b=null}}},_k.Loader=function(a){var b;return{load:function(c){return b||(b=Waiter(a)),b.onComplete(c)}}},_k.Schedule=function(){var a=null,b=!1;return{prepare:function(c){a=c,b&&a()},start:function(){a&&a(),b=!0}}},_k.once=function(a,b){var c=b(function(){a(),array.foreach(c,function(a){a.remove()})})},_k.setTimeout=function(a,b){var c=window.setTimeout(a,b);return{remove:function(){window.clearTimeout(c)}}},_k.polling=function(a,b,c){var d;return func.recursion(function e(){a()?b():d=setTimeout(e,c||100)}),{remove:function(){d&&clearTimeout(d)}}};