_.img=_.bind(function(){var e=this;var a=_.event.Loader(function(l){var m=h.imageNotFound=b("image-not-found"),n=_.element.bind(m,"load",function(){n.remove();l()})});function d(l){return/^#/.test(l)||/^rgba/gi.test(l)}function g(l){return window.contentPath+"image/"+l}function i(m,o){o=o||{};var n=m.fullWidth=o.w||m.naturalWidth||m.width,l=m.fullHeight=o.h||m.naturalHeight||m.height;m.w=m.halfWidth=Math.round(n/2);m.h=m.halfHeight=Math.round(l/2);m.whr=n/l}function k(o,l,s){s=s||{};var r=false,q=!!s.crossOrigin,t,p=/^data:/.test(l);function m(u){o.fail=u?"fatal":true;a.load(function(){s.onError&&s.onError()})}if(!l){m(true);return o}if(d(l)){o.color=l;setTimeout(function(){s.onLoad&&s.onLoad()},0);return o}function n(){if(!r){o.src="";o.src=_.url.concatArg(l,{t:(new Date()).getTime()});r=true}else{m()}}if(!p&&/\.([^.]*)$/.test(_.url.parse(l).pathname.replace(/!([^!]*)$/,""))&&!((t=RegExp.$1) in {jpeg:true,jpg:true,svg:true,png:true,gif:true,bmp:true})){setTimeout(m,0);return o}q&&(o.crossOrigin="*");o.onerror=n;o.onload=function(){if(q&&!e.lowPerformance){try{var u=document.createElement("canvas"),v=u.getContext("2d");u.width=1;u.height=1;v.drawImage(o,0,0);u.toDataURL()}catch(w){n();return}}i(o);o.onerror=null;o.onload=null;s.onLoad&&s.onLoad(o)};o.src=l;return o}function h(m,l){return k(new Image(),m,l)}var b=window.Icon||(e.lowPerformance?function(m){var l=h(g("icon/"+m+".png"));i(l,iconMap[m]);_.css.size(l,l.w,l.h);return l}:(function(){var l={};function m(q,o){var p=q.split("/"),r=["icon"].concat(p.slice(0,p.length-1)).join("-"),n=l[r]=l[r]||new Image();if(!n.waiter){n.waiter=_.event.Waiter(function(t){var s=g(r+".png");k(n,null||s,{crossOrigin:null,onLoad:function(){t()}})})}n.waiter.onComplete(function(){o(n)})}return function(r){var q=iconMap[r],n=document.createElement("canvas"),p=n.getContext("2d"),o=new Image();n.width=q.w;n.height=q.h;i(o,q);_.css.size(o,o.w,o.h);_.css(o,"visibility","hidden");m(r,function(s){p.drawImage(s,q.x,q.y,q.w,q.h,0,0,q.w,q.h);o.onload=function(){o.onload=null;_.css(o,"visibility","visible")};o.src=n.toDataURL("image/png")});return o}})());function j(l){var m=new Image();m.src=l.src;i(m,l);return m}function c(n,l,o){var m=document.createElement("canvas"),p=m.context=m.getContext("2d");o=m.dpr=o||(window.devicePixelRatio||1)/(p.webkitBackingStorePixelRatio||p.mozBackingStorePixelRatio||p.msBackingStorePixelRatio||p.oBackingStorePixelRatio||p.backingStorePixelRatio||1);m.width=n*o;m.height=l*o;_.css(m,{display:"block",width:_.css.px(m.logicalWidth=n),height:_.css.px(m.logicalHeight=l)});p.scale(o,o);return m}function f(l,m){l.innerHTML="";_.css(l,"background","white");h(g(m),{onLoad:function(n){_.element.element(n,{css:_.extend(_.css.center(n.halfWidth),_.css.middle(n.halfHeight))},l)}})}return{Img:h,isColor:d,load:k,clone:j,Canvas:c,Icon:b,staticSrc:g,pageError:f}},{lowPerformance:new Image().crossOrigin===undefined||_.userAgent.iphone&&!_.userAgent.iphone6})();