_.animation=_.bind(function(m,l,i,k){var e=this,b=function(){if(e.prefix===null){e.prefix=k.testPrefix("animation","a 1s")}},h=function(p,o,n){return function(r,q){n();return m.bind(r,o?l.camelcaseJoin([o.replace(/-/g,"")].concat(p)):p.join(""),function(s){s&&s.stopPropagation();q&&q()})}},d=function(q,p,o){var n=h(q,p,o);return function(u,s,v,t){v=v*1000;var r=n(u,function(){r.remove();var w=new Date()-t();_.wrap(s,function(x){if(i.ios&&w<v){setTimeout(function(){x()},v*1.05-w)}else{x()}})()});return r}};var j=d(["animation","end"],e.prefix,b),g=d(["transition","end"],e.prefix,b);function f(o){var p="";b();_.each(o,function(s,r){p+=(parseFloat(r)<<0)+"% {"+k.ruleString(s)+"}"});var n=e.progressTable[p],q;if(!n){n=e.progressTable[p]={count:0,id:q="keyframe"+e.keyframeCount++,handle:k.insertRules("@"+e.prefix+"keyframes "+q,p)}}++n.count;return{id:n.id,remove:function(){if(--n.count===0){n.handle.remove();delete e.progressTable[p]}}}}function c(v,u){u=u||{};var p=null,r=null,n="both",q,s=null,t=[],o=this;_.each(v,function(w){if(_.isObject(w)){s=o.Keyframes(w);t.push(s.id)}else{if(_.isNumber(w)){if(p===null){p=w}else{r=w}t.push(_.css.s(w))}else{switch(w){case"forwards":case"backwards":case"both":n=w;break;default:t.push(w);break}}}if(w==="infinite"){u.infinite=true}});t.push(n);p=p||1;r=r||0;q=p+r;_.extend(u,{end:q,handle:s});return t.join(" ")}function a(s,v,w){var u=null,o=[],r=false,q=this;w=w||{};_.wrap(function(z){var y=z[0],x={el:y};k(y,"animation",q.animation(z.slice(1),x));k(y,"animation-play-state","paused");if(!u||x.end>u.end){u=x}if(x.infinite){r=true}o.push(x)},function(x){_.isArray(s[0])?_.each(s,x):x(s)})();var n;function p(){n=new Date();_.each(o,function(x){k(x.el,"animation-play-state","running")})}w.play!==false&&setTimeout(p,i.ios?30:0);if(v){var t=q.onAnimationEndAdvanced(u.el,function(){_.each(o,function(x){if(w.removeKeyframes){x.handle&&x.handle.remove()}k.remove(x.el,"animation")});v&&v()},u.end,function(){return n});return{play:p,fastForward:t.func}}}return{onAnimationEndAdvanced:j,onTransitionEndAdvanced:g,Keyframes:f,animation:c,runAnimation:a}},{progressTable:{},keyframeCount:0,prefix:null})(_.element,_.string,_.userAgent,_.css);