_.layout=_.bind(function(){var e={},l=_.userAgent.ios||_.userAgent.win32;_.css.insertRules({".animation-prepare *":{"animation-play-state":"paused !important"}});function i(s){return s?_.isString(s)?s:_.css.bezier(s.arg):"ease"}function f(s){return !s.progress["0"]||s.emphasize}function b(s){return _.each(s.progress,function(t){if("perspective" in t){return true}})}function m(s){return _.are2d.origin(_.are2d.combine(_.are2d.matrix.translate(s.x,s.y),_.are2d.matrix.scale(s.scale,s.scale),_.are2d.matrix.rotate(s.rotate/180*Math.PI)),s.w/2,s.h/2)}function p(t){var s=_.are2d.matrix.eye();while(t.parent){s=_.are2d.combine(m(t),s);t=t.parent}return s}function c(t){var s=_.are3d.combine(_.are3d.matrix.scale(t.scale,t.scale,1),_.are3d.matrix.rotateZ(t.rotate/180*Math.PI));t.opacity=t.opacity+0;if(t.left===undefined){_.css(t.element,{left:_.css.px(t.x),top:_.css.px(t.y)})}else{s=_.are3d.combine(_.are3d.matrix.translate(t.x-t.left,t.y-t.top,0),s)}if(_.css.matrix3d(s)!=="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)"){_.css.transform(t.element,_.css.matrix3d(s))}else{_.css.remove(t.element,"transform")}_.css.remove(t.element,"transform-origin")}function h(t){if(t.element){return t.element()}else{var s=_.img.Canvas(t.width,t.height);t.draw(s.context);return _.userAgent.android?_.element.element("div",[s]):s}}function k(v,x){var u=h(v),t=u.wrapper={fixed:true},s={};_.css(u,{position:"absolute",display:"block",left:0,top:0,width:_.css.px(t.w=v.width),height:_.css.px(t.h=v.height),"z-index":0});function w(z,y,B,A){s[z]=y;Object.defineProperty(t,z,{get:function(){return s[z]},set:function(C){s[z]=A?A(C):C;B&&B(C)}})}w("opacity",1,function(y){_.css(u,"opacity",y)});w("zi",0,function(y){_.css(u,"z-index",y)});w("visible",true,function(y){_.css(u,"visibility",y?"visible":"hidden")});_.defineObjectProperty(t,"dataSource",{value:v.dataSource,set:function(y){u.classList.add("layout-component-from-data");u.dataSource=y}});_.each({x:0,y:0},function(y,z){w(z,y,function(){c(t)},function(A){return t.fixed?Math.round(A):A})});Object.defineProperty(t,"origin",{get:function(){return[t.x,t.y]},set:function(y){t.x=y[0];t.y=y[1]}});_.each({rotate:0,scale:1},function(y,z){w(z,y,function(){c(t)})});_.extend(t,{element:u,appendTo:function(y){if(!y.children){y.children=[]}y.children.push(t);y.element.appendChild(u);t.parent=y;return t},draw:function(y){v.draw(y)}});if(x){t.appendTo(x)}return t}function r(s){var t=k({element:function(){return s.element.cloneNode(true)},width:s.w,height:s.h});t.opacity=s.opacity;t.origin=s.origin;t.scale=s.scale;t.rotate=s.rotate;return t}function o(u,v,t){_.recursion(function s(w){if(w.visible&&(t?t(w):true)){w.draw&&w.draw(v);w.children&&_.each(w.children.sort(function(x,y){return x.zi-y.zi}),function(x){v.save();v.globalAlpha*=x.opacity;v.transform.apply(v,m(x));s(x);v.restore()})}},u)}function g(t,u){_.recursion(function s(v){v.children&&_.each(v.children,s);t!==v&&u(v)},t)}function n(y,x,u,z){z=z||{};var t=y.w,A=y.h,s=x.progress;function v(C,B){return _.isString(C)?parseInt(C.replace("%",""))/100*B:C}function w(B){return B!==undefined}_.each(_.map(s,function(C,B){return{ratio:parseInt(B)/100,value:C}}).sort(function(C,B){return C.ratio-B.ratio}),function(D){var B=D.value,E=[],G=B.rotate||0,F=_.isUndefined(B.scale)?1:B.scale,J=x.origin?[x.origin[0]*t-0.5*t,x.origin[1]*A-0.5*A]:null,H=_.omit(_.extend({opacity:1,x:0,y:0,z:0,rotateX:0,rotateY:0,rotateZ:G,scaleX:F,scaleY:F,skewX:0,skewY:0,perspective:0},B),_.isUndefined),I=_.are2d.combine(_.are2d.matrix.scale(y.scale,y.scale),_.are2d.matrix.rotate(y.rotate/180*Math.PI));function C(K,M,L){E.push(_.string.tuple(K,[L(M)]))}delete H.rotate;delete H.scale;H=_.omit(_.extend(H,{x:v(H.x,t),y:v(H.y,A)}),_.isUndefined);J&&E.push(_.css.translate(J[0],J[1],0));w(B.perspective)&&C("perspective",H.perspective,_.css.px);(w(B.x)||w(B.y)||w(B.z))&&E.push(_.css.translate(H.x,H.y,H.z));u!==true&&E.push(_.css.matrix(J?_.are2d.origin(I,t/2-x.origin[0]*t,A/2-x.origin[1]*A):I));(w(B.scaleX)||w(B.scaleY)||w(B.scale))&&E.push(_.css.scale(H.scaleX,H.scaleY));w(B.rotateX)&&C("rotateX",H.rotateX,_.css.deg);w(B.rotateY)&&C("rotateY",H.rotateY,_.css.deg);(w(B.rotateZ)||w(B.rotate))&&C("rotateZ",H.rotateZ,_.css.deg);(w(B.skewX))&&C("skewX",H.skewX,_.css.deg);w(B.skewY)&&C("skewY",H.skewY,_.css.deg);J&&E.push(_.css.translate(-J[0],-J[1],0));z[D.ratio*100]=_.omit(_.extend({"transform-origin":H.origin?_.map(H.origin,function(K){return K*100+"%"}).join(" "):undefined,filter:H.filter,opacity:H.absOpacity!==undefined?H.absOpacity:H.opacity*y.opacity,transform:E.join(" "),visibility:H.visibility===undefined?undefined:H.visibility?"visible":"hidden"},{"animation-timing":H.timing?_.isString(H.timing)?H.timing:_.css.bezier(H.timing.arg):undefined}),_.isUndefined)});return _.animation.Keyframes(z).id}function j(u,x,w,t,v){var s=[n(u,x,false,v),_.css.s(w),_.css.s(t),i(x.timing),"both"];return s.join(" ")}function q(u,w){var v=u.element;_.css(v,"transition",[_.css.s(w.duration),_.css.s(w.delay||0),i(w.timing)].join(" "));_.each(w.end,function(y,x){u[x]=y});function t(){w.onEnd&&w.onEnd();_.css.remove(v,"transition");s.remove()}var s=_.element.bind(v,"webkitTransitionEnd",t);return{fastForward:t}}function a(w,u,s){var y={w:w.w=u,h:w.h=s,xScale:u/320,yScale:s/568},t=_.event.Event(),v=_.event.Event(),x=_.event.Event();y.body=w.body||w;_.css(w,{position:"relative",width:_.css.px(u),height:_.css.px(s),"z-index":0,"backface-visibility":"hidden",overflow:"hidden"});_.defineObjectProperty(y,"background",{value:"black",set:function(z){_.css(w,"background",z)}});return _.extend(w,{draw:function(z){z.fillStyle=y.background;z.fillRect(0,0,u,s);o(y,z,function(A){return w.contains(A.element)&&(!w.classList.contains("animation-prepare")||A.enter==null||f(A.enter))})},recycle:function(){x.trig();w.prepare=function(){return w}},prepare:function(){var A=null,B=_.event.LinkedList(),C,z;w.classList.add("animation-prepare");if(!w.doPagePerspective){g(y,function(D){if(_.userAgent.ios&&D.enter&&b(D.enter)){z=true}});if(z){g(y,function(D){if(D.isElement){_.element.element("div",{css:{position:"absolute",left:0,top:0,transform:"translateZ(10000px)","z-index":D.zi},children:[D.element]},D.element.parentNode)}})}w.doPagePerspective=true}g(y,function(F){var J=F.enter;if(J){var E=J.delay||(J.delay=0),I=J.duration||(J.duration=1),D=E+I,H={},G=F.element;if(l){_.css(G,"animation",j(F,J,I,E))}else{G.animationStyle=j(F,J,I,E,H);if(H[0]){G.normalStyle=G.getAttribute("style");_.css(G,H[0])}}if(!A||A.end<D){A=F;A.end=D}B.insert(F,null);F.animationHandle=_.animation.onAnimationEndAdvanced(F.element,function(){B.remove(F);!J.both&&_.css.remove(G,"animation");J.onEnd&&J.onEnd()},D,function(){return C})}});return _.extend(w,{recycle:function(){x.trig();w.play=function(){return w}},fastForward:function(){},play:function(){if(!l){g(y,function(E){var D=E.element;if(D.animationStyle){if(D.normalStyle){D.setAttribute("style",D.normalStyle)}_.css(D,"animation",D.animationStyle)}})}g(y,function(D){D.left=D.x;D.top=D.y});C=new Date();if(A){_.animation.onAnimationEndAdvanced(A.element,function(){v.trig()},A.end,function(){return C})}else{v.trig()}_.userAgent.win32||_.userAgent.chrome?setTimeout(function(){w.classList.remove("animation-prepare")},30):w.classList.remove("animation-prepare");t.trig();return _.extend(w,{recycle:x.trig,fastForward:function(){_.event.LinkedListForeach(B,function(D){var E=D.enter;_.css.remove(D.element,"animation");E.onEnd&&E.onEnd();D.animationHandle.remove();B.remove(D)});v.trig()}})}})},wrapper:_.extend(y,{visible:true,element:w,onShow:t.regist,onEnterEnd:v.regist,onRemove:x.regist}),toCanvas:function(){var z=_.img.Canvas(u,s);w.draw(z.context);return z}})}function d(t,u){t=t||{};function v(A){var z=A.name in {qrcode:true,screen:true}?A.name:A.label;return A.format||e[z]||e.SingleImage}var y=v(t),s=[],x=[],w={};_.wrap(function(z){var A=[];y=v(z);_.each(z.image||[],function(D,C){var B=D.imageInfo;A.push(function(E){D=_.isString(D)?D:D.url;var F=_.img.Img(D,{crossOrigin:y.crossOrigin,onError:function(){s[C]=F;x[C]=B;E()},onLoad:function(){x[C]=B;s[C]=F;E()}})})});_.each(y.resource,function(C,B){A.push(function(D){var E,G;function F(){w[B]=E;D()}if(/\./.test(C)){C=_.img.staticSrc(C);E=_.img.Img(C,{crossOrigin:null,onError:F,onLoad:function(){F()}})}else{E=_.img.Icon(C);G=_.element.bind(E,"load",function(){setTimeout(F,0);G.remove()})}})});_.each(z.componentImages||[],function(B){A.push(function(C){_.img.load(B,B.targetSrc,{crossOrigin:y.crossOrigin,onError:C,onLoad:C})})});_.event.concurrency(A,function(){u&&u(function(E,B,C,D){var F=_.element.element("div.layout");F.body=D||F;F.pageData=z;F.label=z.label;C=C||{};if(y.ignorePureColor){s=_.filter(s,function(G){return !G.color})}F.resize=function(I,G){F.innerHTML="";a(F,I,G);function H(N,M){return function(O){return O===undefined?N:N?N[O]:M}}try{if(z.fail){alert(new Error())}y.create(F.wrapper,_.omit(_.extend(z,{data:function(){return z.data},kahn1990_imageInfo:function L(M){return x[M]},image:function K(N){if(N===undefined){return _.map(s,function(O,P){return K(P)})}var M=s[N]||_.element.element("img",{fail:"empty"});M.dataSource={from:"image",index:N};return M},getText:function(M){var N=z.text[M]||"";return{dataSource:{from:"text",index:M},toString:function(){return N}}},component:H(z.components,{}),imageinfo:H(z.imageinfo,{}),location:H(z.location,{}),video:H(z.video,""),actionlinks:H(z.actionlinks,""),position:H(z.position,"")}),_.isUndefined),w,C)}catch(J){_.img.pageError(F,"page-error.png")}};F.resize(E,B);return F})})},function(z){y.load?y.load(t,z):z(t)})()}return{formats:e,Component:k,drawComponent:o,loopComponent:g,cloneComponent:r,EnterAnimation:j,contentToElement:h,getPageMatrix:p,loadPage:d,isEmphasize:f,isPerspective:b,transition:q}},{})();